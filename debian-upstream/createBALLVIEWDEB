#!/bin/bash -x
# script to create either 
# 1) a Debian binary package directly from the compiled BALL sources OR
# 2) to create a Debian binary package while creating a source package
# if the second: $1 == source

export BALL_PATH=`pwd | sed "s/debian$//g" | sed "s/debian-upstream$//g"`
export PNAME=ball
export PNAMEC=$PNAME"-common"

if [ $# == 0 ] || [ $1 != "source" ]
then
	rm -rf debian 2>/dev/null
	cp -r debian-upstream debian
fi
	cd $BALL_PATH/debian 								 &&
	mkdir -p libball/usr/lib						 &&
	mkdir -p libball/usr/share/BALL		   &&
	mkdir -p libball-dev/usr/include     &&
	mkdir -p libball-dev/usr/lib		   	 &&
	mkdir -p libball-dev/usr/share/BALL	 &&
	mkdir -p ballview/usr/bin 					 &&
	mkdir -p ballview/usr/share/man/man1	#&&

#	mkdir -p $PNAMEC/usr/share/BALL/doc && 				
#	mkdir -p $PNAMEC/usr/share/doc/ballview/html/
#fi

cd $BALL_PATH/debian
#rm -f BALLView 

#cp ../debian-upstream/BALLView $PNAME/usr/bin/ 														&&
cp    /usr/lib/libBALL*      libball/usr/lib/						&&
cp    /usr/lib/libVIEW*      libball/usr/lib/						&&
cp -r /usr/share/BALL/data   libball/usr/share/BALL   	&&
cp -r /usr/include/BALL      libball-dev/usr/include    &&
cp    ../source/APPLICATIONS/BALLVIEW/BALLView ballview/usr/bin/				  		&&

mv libball/usr/lib/libBALL.so libball-dev/usr/lib	&&
mv libball/usr/lib/libBALL.a  libball-dev/usr/lib &&
mv libball/usr/lib/libVIEW.so libball-dev/usr/lib &&
mv libball/usr/lib/libVIEW.a  libball-dev/usr/lib &&
#cp    ../debian-install/ball/bin/BALLView    ballview/usr/bin/
#cp -r ../source/APPLICATIONS/BALLVIEW/BALLView $PNAME/usr/lib/BALL 				&&
#cp    ../source/APPLICATIONS/BALLVIEW/BALLView $PNAME/usr/bin/						&&

#cp -r ../doc/BALLView 							$PNAMEC/usr/share/doc/ballview/html/	&&
#cp -r ../doc/BALL 									$PNAMEC/usr/share/doc/ballview/html/ 	&&
#cp    ../doc/TUTORIAL/tutorial.pdf 	$PNAMEC/usr/share/doc/ballview/ 			&&
#cp -r ../doc/classes 								$PNAMEC/usr/share/BALL/doc 						&&
#cp -r ../doc/internal 							$PNAMEC/usr/share/BALL/doc/internal 	&&
#cd $PNAMEC/usr/share/BALL/doc/																						&&
#cd -																																			&&

cp ../debian-upstream/ballview.1 ballview/usr/share/man/man1/ 							&&
cp ../debian-upstream/ballview.1 ballview/usr/share/man/man1/BALLView.1 		&&
#gzip -9 $PNAME/usr/share/man/man1/ballview.1 						&&
#gzip -9 $PNAME/usr/share/man/man1/BALLView.1 						&&

cp -r ../source/EXAMPLES/PYTHON libball-dev/usr/share/BALL 	&&

chmod ugo-x libball/usr/share/BALL/data/QSAR/* 					&&
chmod ugo-x libball/usr/share/BALL/data/CHARMM/charmm* 	&&
chmod ugo-x libball/usr/share/BALL/data/graphics/* 			&&
#chmod ugo-x libball/usr/share/BALL/PYTHON/*.py 					&&
chmod ugo-x libball/usr/share/BALL/data/structures/* 		&&
chmod 755   libball/usr/share/BALL/data/structures/DB/ 	&&
chmod ugo+x ballview/usr/bin/BALLView 									&&

strip --strip-unneeded libball/usr/lib/*     &&
strip --strip-unneeded libball-dev/usr/lib/* &&
strip --strip-unneeded ballview/usr/bin/*   

if [ $# == 1 ] && [ $1 == "source" ]
then
	echo ready for packaging...
#else
#	mkdir $PNAME/DEBIAN 							&&
#	cp * $PNAME/DEBIAN 2>/dev/null    
#	chmod -R 0755 $PNAME/DEBIAN 			&&
#	dpkg -b $PNAME BALLView.deb 			&&
#	rm -rf $PNAME 										&&
#	mv BALLView.deb ~
fi

